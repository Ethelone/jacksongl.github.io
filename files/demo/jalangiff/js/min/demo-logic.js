/*
 * Copyright 2014 Liang Gong.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *        http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*
 * Copyright 2014 Liang Gong.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *        http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

(function(){function k(){p&&(q++,3<=q&&(p=!1,setTimeout(y,50)))}function y(){$($(".demo-content")[0]).fadeIn(500);$($(".demo-footer")[0]).fadeIn(500);setTimeout(z,400)}function z(){c["ex:0:source"].setValue(c["ex:0:source"].getValue());c["ex:1:source"].setValue(c["ex:1:source"].getValue());c["ex:2:source"].setValue(c["ex:2:source"].getValue());$("#dropdown-menu-v-divider").height($("#dropdown-block-1").height())}function r(a){$.ajax({type:"GET",url:a,dataType:"text",async:!0,success:function(a){window.setTimeout(function(){g= !0;c["ex:0:source"].setValue(a);g=!1;k()},250+0*Math.random()|0)}})}function s(a){$.ajax({type:"GET",url:a,dataType:"text",async:!0,success:function(a){window.setTimeout(function(){c["ex:1:source"].setValue(a);k()},260+100*Math.random()|0)}})}function t(a){$.ajax({type:"GET",url:a,dataType:"text",async:!0,success:function(a){window.setTimeout(function(){c["ex:2:source"].setValue(a);k()},250+50*Math.random()|0)}})}function u(a){function d(){c&&b&&$("#problem-description").html(e).show("slow")}var c= !1,b=!1,e=null;window.setTimeout(function(){$("#problem-description").hide("slow",function(){c=!0;d()})},500);$.ajax({type:"GET",url:a,dataType:"text",async:!0,success:function(a){e=a;0<e.replace(RegExp(" ","g"),"").length&&(b=!0,d())}})}function h(a){var d=this;try{esnstrument.setBaseIid}catch(c){setTimeout(function(){h.call(d,a)},400)}l&&this.clearMarker(l);var b=a.split(":")[1],b=document.getElementById("ex:"+b+":result");try{var e=this.getValue();esnstrument.setBaseIid(0);var g="/* Code transformed by Jalangi */ \n"+ esnstrument.instrumentCode(e,{wrapProgram:!1,isEval:!1}).code;b.innerHTML=g}catch(f){b.innerHTML=f.message,f.lineNumber&&(l=this.setMarker(f.lineNumber-1,'<span style="color: #900">x</span> %N%'))}}function m(a,d){var e=a.split(":")[1],b=document.getElementById("ex:"+e+":result");try{v=new A;b.innerHTML="";n=function(a){b.innerHTML+=a+"\n"};var f=c["ex:2:source"].getValue(),g=c["ex:1:source"].getValue();b.innerHTML+="-----------------------------------------------------\n";start=new Date;var h=this.getValue(); esnstrument.setBaseIid(0);var k=esnstrument.instrumentCode(h,{wrapProgram:!1,isEval:!0});inst_code=g+"\n\n"+f+"\n\n"+k.code+"\n\n J$.endExecution();";inst_code="consoleOutput = ''; var console_log = console.log; console.log = function () {var str = arguments[0]; if(typeof str === 'undefined'){str = '';} else if (typeof str ==='object') {if(str === null){str = 'null';}consoleOutput += ('' + str.toString() + '\\n');} else consoleOutput += ('' + str + '\\n');}; \n"+inst_code+"\n\n\n console.log = console_log;";b.innerHTML+="code transformed in: "+(new Date- start)+" ms\n";start=new Date;(new Function(inst_code))();v.begin(null);b.innerHTML+="-----------------------------------------------------\n";b.innerHTML+="Executed in : "+(new Date-start)+" ms.\n";"undefined"!==typeof consoleOutput&&(b.innerHTML+="-----------------------------------------------------\n",b.innerHTML+="Console output : \n"+consoleOutput)}catch(l){b.innerHTML=l.message}}function w(){var a=B.height()+35;C.style.height=(a<x?x:a)+"px"}window.delay_load=function(a){var d=document.createElement("script"); d.src=a;document.getElementsByTagName("head")[0].appendChild(d)};$(".carousel").carousel({interval:5E3});$(".tooltip-social").tooltip({selector:"a[data-toggle=tooltip]"});var p=!0,q=0;window.reloadAnalysisFiles=function(a){r("files/"+a+"/target1.js");s("files/analysis.js");t("files/"+a+"/plugin.js");u("files/"+a+"/problem.html")};var e=0;$(".example").replaceWith(function(){var a=this.innerHTML,d=a.split("\n").length,a='<table class="example"><tr><td data-intro="Write or copy/paste the code here. The code will be transformed and analysed" data-position="left" data-step="1"><textarea id="ex:'+ e+':source" class="jcCode" rows="'+d+'" spellcheck="false">'+a+'</textarea></td><td data-intro="Transformed code will be shown here lively, after running the code, here shows the console output." data-position="right" data-step="2" valign="top"><pre style="overflow: auto; overflow-y: auto; height:100%" id="ex:'+e+':result" class="jcResult"></pre></td></tr></table><table class="toolbar"><tr><td data-intro="click to run. <br/> Or use Ctr-Enter." data-position="left" data-step="3"><div id="ex:'+e+'" class="run-button noselect" title="Ctrl-Enter">Run Analysis</div></td></tr></table>'; e++;return a});$(".analysis_code").replaceWith(function(){var a=$("#plugin_id")[0].innerHTML;$("#plugin_id");var d=this.innerHTML,c=d.split("\n").length,a='<table class="analysis_code"><tr><td data-intro="Jalangi runtime framework code called by transformed code, we do not recommend you modify it." data-position="left" data-step="4"><textarea id="ex:'+e++ +':source" class="jcCode" rows="'+c+'" spellcheck="false">'+d+'</textarea></td><td data-intro="Third party plugin code invoked by Jalangi runtime framework code, feel free to override hooks here to create your own analysis." data-position="right" data-step="5"><textarea id="ex:'+ e+':source" class="jcCode" rows="'+c+'" spellcheck="false">'+a+"</textarea></td></tr></table>";e++;return a});$(".dropdown").on("show.bs.dropdown",function(a){$(this).find(".dropdown-block").first().stop(!0,!0).fadeIn(200,function(){})});$(".dropdown").on("hide.bs.dropdown",function(a){$(this).find(".dropdown-block").first().stop(!0,!0).fadeOut(300,function(){})});$("#live_tour").click(function(){introJs().start()});$("#show_file_org").click(function(){$("#mechanism_explain").is(":visible")?($("#mechanism_explain").hide("slow"), $("#show_file_org").html("More Details")):($("#mechanism_explain").show("slow"),$("#show_file_org").html("Hide Details"))});$("#share_analysis").click(function(){$("#share_instruction").is(":visible")?($("#share_instruction").hide("slow"),$("#share_analysis").html("Share Your Analysis")):($("#share_instruction").show("slow"),$("#share_analysis").html("Hide Share Instuctions"))});$(".plugin_code").replaceWith(function(){return""});var l;window.getLocationFromIID=function(a){var d=window.iidToLocationMap[a], c="";return c=d?"line No.: "+d[1]+", col: "+d[2]:"[iid]: "+a};var A=function(){function a(){this.start=this.name=null}a.prototype.begin=function(a){this.start&&(this.name?n("Timer: "+(new Date-this.start)+" ms: "+this.name):n("Timer: "+(new Date-this.start)+" ms."));this.start=new Date;this.name=a};return a}(),v,n,c={},g=!1,g=!0;(function(){$(".example .jcCode").each(function(){var a=this.id,d=c[a]=CodeMirror.fromTextArea(this,{tabSize:2,lineNumbers:!0,gutter:!0,onChange:function(){setTimeout(w,0); g?setTimeout(function(){h.call(d,a)},0):h.call(d,a)},extraKeys:{"Ctrl-Enter":function(){m.call(d,a)},"Cmd-Enter":function(){m.call(d,a)}},theme:"jacksongl"});h.call(d,a)})})();var g=!1,f=window.location.search.replace("?","");switch(f){case "nan":break;case "jit":break;case "imp":break;case "eval":break;case "fault_loc":break;case "objalloc":break;case "memo":break;case "longrunfun":break;case "crossbrowser":break;case "dom_prop_attr":break;case "style_string":break;case "loop":break;case "profile":break; case "dom_lookup":break;case "caching_optim":break;case "reveal_cookie":break;case "regexp":break;case "set_field_primitive":break;case "small_interval":break;case "double_eval":break;case "bit_op":break;default:f="helloworld"}r("files/"+f+"/target1.js");s("files/analysis.js");t("files/"+f+"/plugin.js");u("files/"+f+"/problem.html");$(".analysis_code .jcCode").each(function(){c[this.id]=CodeMirror.fromTextArea(this,{tabSize:2,lineNumbers:!0,gutter:!0,theme:"jacksongl"})});$(".run-button").click(function(){var a= this.id.split(":")[1];m.call(c["ex:"+a+":source"],this.id)});var B=$(document.getElementsByClassName("CodeMirror-lines")[0]),C=document.getElementById("ex:0:result"),x=200;setInterval(w,1E3);window.JALANGI_MODE="inbrowser"})();